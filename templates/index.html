<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- 다양한 언어를 사용할 수 있도록 UTF-8 을 사용하도록 합니다. -->
    <meta charset="UTF-8" />

    <!-- 반응형으로 동작하게 합니다. -->
    <meta title="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap 을 포함합니다. -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />

    <!-- jQuery 를 포함합니다. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- CSS library 인 Bulma 를 포함합니다. -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"
    />

    <!-- 텍스트형태로 되어있는 icon 을 쓸 수 있도록 Font awesome 을 포함하빈다. -->
    <script
      defer
      src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"
    ></script>

    <style>
      .modal {
        z-index: 1050;
      }
      .modal-open {
        overflow: hidden;
      }
    </style>

    <title>Login - Study Gram</title>

    <!-- 이 HTML 안에서 사용할 CSS 를 정의합니다. -->
    <!-- . 으로 시작하는 단어는 CSS clas 에 해당하며 . 을 제외한 이름을 HTML tag 에서 class="..." 형태로 사용합니다. -->
    <!-- 예: <div class="center"> -->
    <!-- <style src="../public/style.css"></style> -->

    <!-- 이 HTML 에서 사용할 JavaScript 를 작성합니다. -->
    <script>
      // 로그인 폼 제출 시
      $("#loginForm").submit(function (event) {
        event.preventDefault(); // 기본 제출 동작 방지

        console.log("hello");
        var form = $(this);
        var url = "/login";
        var formData = form.serialize(); // 폼 데이터 직렬화

        $.ajax({
          type: "POST",
          url: url,
          data: formData,
          username: "qwe",
          password: "ewq",
          success: function (response) {
            // 서버로부터의 성공 응답 처리
            window.location.href = response.redirect_url; // 로그인 성공 시 리다이렉트
          },
          error: function (xhr, status, error) {
            // 서버로부터의 실패 응답 처리
            var errorMessage = xhr.responseJSON.message;
            alert(errorMessage); // 오류 메시지 표시
          },
        });
      });

      // 회원가입 폼 제출 시
      $("#registerForm").submit(function (event) {
        event.preventDefault(); // 기본 제출 동작 방지
        var form = $(this);
        var url = form.attr("action");
        let payload = { username: "qwe", password: "ewq" };
        var formData = form.serialize(); // 폼 데이터 직렬화

        $.ajax({
          type: "POST",
          url: "/register",
          data: formData,
          success: function (response) {
            // 서버로부터의 성공 응답 처리
            $("#registerModal").modal("hide"); // 모달 닫기
            alert(response.message); // 회원가입 성공 메시지 표시
          },
          error: function (xhr, status, error) {
            // 서버로부터의 실패 응답 처리
            var errorMessage = xhr.responseJSON.message;
            alert(errorMessage); // 오류 메시지 표시
          },
        });
      });
    </script>
  </head>

  <!-- HTML 본문에 해당합니다. -->
  <!-- HTML 태그를 이용해서 layout 을 대략적으로 잡아두고, -->
  <!-- 위에 정의된 JavaScript 를 통해 동적으로 데이터를 조작해 최종 HTML 이 만들어집니다. -->
  <body>
    <!-- 제목 부분 -->
    <section class="hero is-warning">
      <div class="hero-body">
        <div class="container center">
          <h1 class="title">스터디 그램</h1>
          <h2 class="subtitle">알고리즘 문제를 풀고 강의를 함께 들어봅시다!</h2>
        </div>
      </div>
    </section>

    <!-- 로그인 부분  -->
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card mt-5">
            <div class="card-header">
              <h2 class="text-center">스터디 그램 로그인</h2>
            </div>
            <div class="card-body">
              <form id="loginForm">
                <div class="form-group">
                  <label for="username">정글러 아이디</label>
                  <input
                    placeholder="정글러 id를 입력하세요."
                    type="text"
                    class="form-control"
                    id="username"
                    name="username"
                  />
                </div>
                <div class="form-group">
                  <label for="password">패스워드</label>
                  <input
                    placeholder="패스워드를 입력하세요."
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                  />
                </div>
                <br />
                <button
                  type="submit"
                  class="btn btn-primary btn-block"
                  name="login"
                >
                  로그인
                </button>
                <br />

                <!-- Trigger/Register Modal -->
                <button
                  type="button"
                  class="btn btn-info"
                  data-toggle="modal"
                  data-target="#registerModal"
                >
                  회원 가입
                </button>
              </form>
            </div>

            <!-- Register Modal -->
            <div
              class="modal fade"
              id="registerModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="registerModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">
                      회원 가입 하기
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <!-- Registration Form -->
                    <form id="registerForm" method="POST">
                      <div class="form-group">
                        <label for="registerUsername">정글러 아이디</label>
                        <input
                          type="text"
                          class="form-control"
                          id="registerUsername"
                          placeholder="사용할 정글러 아이디를 입력해주세요."
                          name="username"
                        />
                      </div>
                      <div class="form-group">
                        <label for="registerPassword">패스워드</label>
                        <input
                          type="password"
                          class="form-control"
                          id="registerPassword"
                          placeholder="패스워드를 입력해주세요."
                          name="pass"
                        />
                      </div>
                      <div class="form-group">
                        <label for="registerBaekjoonId">백준 아이디</label>
                        <input
                          type="text"
                          class="form-control"
                          id="registerBaekjoonId"
                          placeholder="백준 아이디를 입력해주세요."
                          name="baekjoonId"
                        />
                      </div>
                    </form>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Close
                    </button>
                    <button
                      type="submit"
                      form="registerForm"
                      class="btn btn-primary"
                      name="register"
                    >
                      Register
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->

    <!-- Bootstrap library -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
