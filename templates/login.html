<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- ë‹¤ì–‘í•œ ì–¸ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ UTF-8 ì„ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤. -->
    <meta charset="UTF-8" />
    <!-- ë°˜ì‘í˜•ìœ¼ë¡œ ë™ì‘í•˜ê²Œ í•©ë‹ˆë‹¤. -->
    <meta title="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap ì„ í¬í•¨í•©ë‹ˆë‹¤. -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- jQuery ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- CSS library ì¸ Bulma ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"
    />

    <!-- êµ¬ê¸€ í°íŠ¸ : Dancing Script -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap"
      rel="stylesheet"
    />

    <!-- í…ìŠ¤íŠ¸í˜•íƒœë¡œ ë˜ì–´ìˆëŠ” icon ì„ ì“¸ ìˆ˜ ìˆë„ë¡ Font awesome ì„ í¬í•¨í•˜ë¹ˆë‹¤. -->
    <script
      defer
      src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"
    ></script>
    <link rel="stylesheet" href="../static/style.css" />
    <title>Login - Study Gram</title>

    <script>
      // ë¡œê·¸ì¸ í¼ ì œì¶œ ì‹œ
      function submitLoginForm() {
        let form = $(this);
        let url = "/login";
        let f_username = $("#username").val();
        let f_password = $("#password").val();

        if (f_username === "") {
          // alert("Input your Id.");
          $(".login-info-text").text("please input jungler id."); // ë‚´ìš© ë³€ê²½
          return;
        }
        if (f_password === "") {
          $(".login-info-text").text("please input password."); // ë‚´ìš© ë³€ê²½
          return;
        }

        $.ajax({
          type: "POST",
          url: url,
          data: { usernames: `${f_username}`, passwords: `${f_password}` },
          success: function (response) {
            // ì„œë²„ë¡œë¶€í„°ì˜ ì„±ê³µ ì‘ë‹µ ì²˜ë¦¬
            if (response["result"] == "success") {
              alert("Login Verified!");
              window.location.reload();
              window.location.href = `/index?bjid=${response["baekjoonId"]}&id=${f_username}`;
              localStorage.setItem("AccessToken", response["access_token"]);
            } else {
              alert("ì„œë²„ ë¬¸ì œ : ê´€ë¦¬ìì—ê²Œ ì—°ë½í•˜ì„¸ìš”.");
              window.location.reload();
            }
          },
          error: function (response) {
            // ì„œë²„ë¡œë¶€í„°ì˜ ì‹¤íŒ¨ ì‘ë‹µ ì²˜ë¦¬
            alert(response.responseJSON.msg); // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            window.location.reload();
          },
        });
      }

      // íšŒì›ê°€ì… í¼ ì œì¶œ ì‹œ
      function submitRegisterForm() {
        let form = $(this);
        let url = "/register";
        let register_username = $("#registerUsername").val();
        let register_password = $("#registerPassword").val();
        let register_baekjoonId = $("#registerBaekjoonId").val();

        if (register_username === "") {
          $(".modal-form-info-text").text("please input jungler id."); // ë‚´ìš© ë³€ê²½
          return;
        }
        if (register_password === "") {
          $(".modal-form-info-text").text("please input password."); // ë‚´ìš© ë³€ê²½
          return;
        }
        if (register_baekjoonId === "") {
          $(".modal-form-info-text").text("please input Baekjoon Id."); // ë‚´ìš© ë³€ê²½
          return;
        }

        $.ajax({
          type: "POST",
          url: "/register",
          data: {
            give_username: `${register_username}`,
            give_password: `${register_password}`,
            give_baekjoonId: `${register_baekjoonId}`,
          },
          success: function (response) {
            // ì„œë²„ë¡œë¶€í„°ì˜ ì„±ê³µ ì‘ë‹µ ì²˜ë¦¬
            if (response["result"] == "success") {
              alert("íšŒì› ê°€ì…ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
              window.location.reload();
            } else {
              // í˜¹ì€ ë‹¤ë¥¸ ë©”ì‹œì§€
              alert("íšŒì› ê°€ì…ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
              window.location.reload();
            }
          },
          error: function (response) {
            // ì„œë²„ë¡œë¶€í„°ì˜ ì‹¤íŒ¨ ì‘ë‹µ ì²˜ë¦¬
            alert(response.responseJSON.error);
            // $("#registerUsername");
            // window.location.reload();
          },
        });
        registerSubmitFlag = true;
        return true;
      }
    </script>
  </head>

  <body style="background-color: black">
    <!-- ì œëª© ë¶€ë¶„ -->
    <!-- <section class="hero is-small is-primary"> -->
    <section class="title-section">
      <div class="hero-body">
        <div class="container center">
          <h1 class="title">ğ“¼ğ“½ğ“¾ğ“­ğ”‚ğ“°ğ“»ğ“ªğ“¶</h1>
          <h2 class="subtitle">ë‚˜ë§Œì˜ ìŠ¤í„°ë””ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</h2>
        </div>
      </div>
    </section>
    <!-- ë¡œê·¸ì¸ ë¶€ë¶„  -->
    <div class="main-container">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card mt-5">
            <div class="card-header">
              <h2 class="text-center" id="login-title-text">studygram login</h2>
            </div>
            <div class="card-body">
              <div id="loginForm">
                <div class="form-group">
                  <label for="username">Jungler ID</label>
                  <input
                    placeholder="Input your Id."
                    type="text"
                    class="form-control transparent-input"
                    id="username"
                    name="username"
                  />
                </div>
                <div class="form-group">
                  <label for="password">Password</label>
                  <input
                    placeholder="Input your password."
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    autocomplete="off"
                  />
                </div>
                <div class="login-info"><p class="login-info-text"></p></div>
                <br />
                <button
                  onclick="submitLoginForm()"
                  type="button"
                  class="btn btn-secondary btn-block"
                  name="login"
                >
                  Login
                </button>
                <br />
              </div>
              <!-- Trigger/Register Modal -->
              <button
                type="button"
                class="btn btn-secondary btn-block"
                data-toggle="modal"
                data-target="#registerModal"
              >
                Register
              </button>
            </div>
            <!-- Register Modal -->
            <div
              class="modal fade"
              id="registerModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="registerModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">
                      REGISTER STUDTGRAM
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <!-- Registration Form -->
                    <div>
                      <div class="form-group">
                        <label for="registerUsername">Krafton Jungler Id</label>
                        <input
                          type="text"
                          class="form-control"
                          id="registerUsername"
                          placeholder="Please input Id."
                          name="username"
                        />
                      </div>
                      <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input
                          type="password"
                          class="form-control"
                          id="registerPassword"
                          placeholder="Input password."
                          name="pass"
                          autocomplete="off"
                        />
                      </div>
                      <div class="form-group">
                        <label for="registerBaekjoonId">Baekjoon Id</label>
                        <input
                          type="text"
                          class="form-control"
                          id="registerBaekjoonId"
                          placeholder="Please input your Baekjoon Id."
                          name="baekjoonId"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="modal-form-info">
                    <p class="modal-form-info-text">Please fill the form.</p>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-light"
                      data-dismiss="modal"
                    >
                      Close
                    </button>
                    <button
                      type="button"
                      class="btn btn-dark"
                      name="register"
                      onclick="submitRegisterForm()"
                    >
                      Register
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <br />
    <br />
    <!-- Modal -->
    <!-- Bootstrap library -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
